var ZeroClipboard={version:"1.0.7",clients:{},moviePath:'/include/flash/zeroclipboard.swf',nextId:1,$:function(thingy){if(typeof(thingy)=='string')thingy=document.getElementById(thingy);if(!thingy.addClass){thingy.hide=function(){this.style.display='none';};thingy.show=function(){this.style.display='';};thingy.addClass=function(name){this.removeClass(name);this.className+=' '+name;};thingy.removeClass=function(name){var classes=this.className.split(/\s+/);var idx=-1;for(var k=0;k<classes.length;k++){if(classes[k]==name){idx=k;k=classes.length;}}
if(idx>-1){classes.splice(idx,1);this.className=classes.join(' ');}
return this;};thingy.hasClass=function(name){return!!this.className.match(new RegExp("\\s*"+name+"\\s*"));};}
return thingy;},setMoviePath:function(path){this.moviePath=path;},dispatch:function(id,eventName,args){var client=this.clients[id];if(client){client.receiveEvent(eventName,args);}},register:function(id,client){this.clients[id]=client;},getDOMObjectPosition:function(obj,stopObj){var info={left:0,top:0,width:obj.width?obj.width:obj.offsetWidth,height:obj.height?obj.height:obj.offsetHeight};while(obj&&(obj!=stopObj)){info.left+=obj.offsetLeft;info.top+=obj.offsetTop;obj=obj.offsetParent;}
return info;},Client:function(elem){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId='ZeroClipboardMovie_'+this.id;ZeroClipboard.register(this.id,this);if(elem)this.glue(elem);}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:'',handCursorEnabled:true,cssEffects:true,handlers:null,glue:function(elem,appendElem,stylesToAdd){this.domElement=ZeroClipboard.$(elem);var zIndex=99;if(this.domElement.style.zIndex){zIndex=parseInt(this.domElement.style.zIndex,10)+1;}
if(typeof(appendElem)=='string'){appendElem=ZeroClipboard.$(appendElem);}
else if(typeof(appendElem)=='undefined'){appendElem=document.getElementsByTagName('body')[0];}
var box=ZeroClipboard.getDOMObjectPosition(this.domElement,appendElem);this.div=document.createElement('div');var style=this.div.style;style.position='absolute';style.left=''+box.left+'px';style.top=''+box.top-5+'px';style.width=''+box.width+'px';style.height=''+box.height+'px';style.zIndex=zIndex;if(typeof(stylesToAdd)=='object'){for(addedStyle in stylesToAdd){style[addedStyle]=stylesToAdd[addedStyle];}}
appendElem.appendChild(this.div);this.div.innerHTML=this.getHTML(box.width,box.height);},getHTML:function(width,height){var html='';var flashvars='id='+this.id+'&width='+width+'&height='+height;if(navigator.userAgent.match(/MSIE/)){var protocol=location.href.match(/^https/i)?'https://':'http://';html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+protocol+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+width+'" height="'+height+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/><param name="wmode" value="transparent"/></object>';}
else{html+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+width+'" height="'+height+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'" wmode="transparent" />';}
return html;},hide:function(){if(this.div){this.div.style.left='-2000px';}},show:function(){this.reposition();},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML='';var body=document.getElementsByTagName('body')[0];try{body.removeChild(this.div);}catch(e){;}
this.domElement=null;this.div=null;}},reposition:function(elem){if(elem){this.domElement=ZeroClipboard.$(elem);if(!this.domElement)this.hide();}
if(this.domElement&&this.div){var box=ZeroClipboard.getDOMObjectPosition(this.domElement);var style=this.div.style;style.left=''+box.left+'px';style.top=''+box.top+'px';}},setText:function(newText){this.clipText=newText;if(this.ready)this.movie.setText(newText);},addEventListener:function(eventName,func){eventName=eventName.toString().toLowerCase().replace(/^on/,'');if(!this.handlers[eventName])this.handlers[eventName]=[];this.handlers[eventName].push(func);},setHandCursor:function(enabled){this.handCursorEnabled=enabled;if(this.ready)this.movie.setHandCursor(enabled);},setCSSEffects:function(enabled){this.cssEffects=!!enabled;},receiveEvent:function(eventName,args){eventName=eventName.toString().toLowerCase().replace(/^on/,'');switch(eventName){case'load':this.movie=document.getElementById(this.movieId);if(!this.movie){var self=this;setTimeout(function(){self.receiveEvent('load',null);},1);return;}
if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var self=this;setTimeout(function(){self.receiveEvent('load',null);},100);this.ready=true;return;}
this.ready=true;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);break;case'mouseover':if(this.domElement&&this.cssEffects){this.domElement.addClass('hover');if(this.recoverActive)this.domElement.addClass('active');}
break;case'mouseout':if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass('active')){this.domElement.removeClass('active');this.recoverActive=true;}
this.domElement.removeClass('hover');}
break;case'mousedown':if(this.domElement&&this.cssEffects){this.domElement.addClass('active');}
break;case'mouseup':if(this.domElement&&this.cssEffects){this.domElement.removeClass('active');this.recoverActive=false;}
break;}
if(this.handlers[eventName]){for(var idx=0,len=this.handlers[eventName].length;idx<len;idx++){var func=this.handlers[eventName][idx];if(typeof(func)=='function'){func(this,args);}
else if((typeof(func)=='object')&&(func.length==2)){func[0][func[1]](this,args);}
else if(typeof(func)=='string'){window[func](this,args);}}}}};
;ImgurAlbum=function(params){var imgurAlbum=this,settings={id:null,images:null,cover:null,layout:null,cdn_url:null,preloadCount:4,operation:null,mobile:false},elements={links:{createAlbum:$('.album-create-link'),changeSettings:$('.album-settings-link'),changeImages:$('.album-images-link'),changeCover:$('.album-cover-link'),deleteAlbum:$('.album-delete-link'),embedAlbum:$('.album-embed-link'),titleDesc:$('.album-titledesc-link'),rearrange:$('.album-rearrange-link')},embedAlbumForm:{id:'#embed-album-form',embedCodeInput:$('#embed-album-form #embedcode'),clipboardContainer:$('#embed-album-form .clipboard-container')},createAlbumForm:{id:'#create-album-form',form:$('#create-album-form form'),header:$('#create-album-form h1'),titleInput:$('#album-title'),descriptionInput:$('#album-description'),layoutInput:$('#album-layout input[type=radio]'),privacyInput:$('#album-privacy input[type=radio]'),loader:$('#create-album-loader'),cover:$('#album-cover'),hiddenIcon:$('.privacy-icon.hidden'),secretIcon:$('.privacy-icon.secret'),exlanationPublic:$('.privacy-explanation.public'),exlanationHidden:$('.privacy-explanation.hidden'),exlanationSecret:$('.privacy-explanation.secret'),privacyTitle:$('.privacy-title'),errorbox:$('#create-album-form .error'),submitButton:$('#create-album-form input[type="submit"]')},albumImagesForm:{id:'#album-images',form:$('#album-images form'),selectHeader:$('#album-images-select-header'),coverHeader:$('#album-images-cover-header')},deleteAlbumForm:{id:'#delete-album-form',yes:$('#delete-album-yes'),no:$('#delete-album-no'),loader:$('#delete-album-form .small-loader')},layout:{global:{title:$('#title'),description:$('#description'),container:$('#image-container'),mainCarousel:$('#image-container'),mainImage:$('#image'),thumbsCarousel:$('#thumbs-top, #thumbs-bottom'),thumbsCarouselContainer:$('.thumbs-carousel'),thumbsCarouselNext:$('.thumbs-carousel .carousel-button.next'),thumbsCarouselPrev:$('.thumbs-carousel .carousel-button.prev'),thumbsCarouselTop:$('#thumbs-top'),thumbsCarouselBottom:$('#thumbs-bottom'),nextImage:$('#next'),prevImage:$('#prev'),imageHoverIconClass:'.image-hover'},blog:{leftPanel:$('#content .main'),sidebar:$('#scrollpanel')},horizontal:{imageCounter:$('#current-index')},grid:{imageClass:'.post'},rearrange:{sortableItem:'.image',saveLink:$('#save'),loader:$('#loader'),sorts:$('.sort'),orders:$('.order'),orderMenu:$('#order-menu')},titledesc:{title:$('.image-title'),desc:$('.image-desc'),save:$('#save'),cancel:$('#cancel'),form:$('#image-container form'),loader:$('#loader'),items:$('.item')}},subdomain:{container:$('.left .panel'),albumClass:'.album',editButton:$('.edit-button'),editOptionsClass:'.edit-options',editOptionsItems:$('.options .item'),accountBio:$('#account-bio')}},layouts={blog:'b',grid:'g',horizontal:'h',vertical:'v'},operations={embed:'embed',rearrange:'rearrange',titledesc:'titledesc'},messages={createAlbum:'Create an album',albumSettings:'Change album settings',updateSettings:'Album settings have been updated',updateImages:'Album images have been updated',updateCover:'Album cover has been updated',rearrangeImages:'Images have been rearranged',updateTitleDesc:'Titles and/or descriptions have been updated',deleteAlbum:'Album has been deleted',defaultAccountBio:'This is your public profile. Write something about yourself!'},vars={currentImageIndex:0,ajaxURL:'/ajaxalbums/',albumImages:null,interval:null,loadingViewport:false,bodyHeight:0,thumbsSpeed:400,embedClipboard:null,scrolling:false,rearrangeOrder:1,creatingAlbum:false,bindings:{create:false,images:false,del:false,thumbs:false,main:false}},getImageSuffix=function(image){var imageSizes=Imgur.getImageSizes();return(image.width<=imageSizes.hugeThumb.width||image.animated)?imageSizes.original.suffix:imageSizes.hugeThumb.suffix;},findImageIndex=function(hash){for(var i=0;i<settings.images.count;++i){if(settings.images.items[i].hash==hash){return i;}}
return 0;},getStartingIndex=function(){var hash=Imgur.getPageHash();if(hash){if(isNaN(hash)){return findImageIndex(hash);}else{return parseInt(hash);}}
return 0;},loadImage=function(img){if(!img)return;if(!img.hasClass('unloaded'))return;img.attr('src',img.attr('data-src'));img.removeClass('unloaded');var loadImage=new Image();loadImage.src=img.attr('src');loadImage.onload=function(){if(settings.layout==layouts.horizontal&&!settings.operation){if($(document).height()>vars.bodyHeight){vars.bodyHeight=$(document).height();$('body').css('height',vars.bodyHeight);}}};loadImage.onerror=function(){var hash=settings.images.items[vars.currentImageIndex];if(hash){this.src=settings.cdn_url+'/'+hash.hash+hash.ext;img.attr('src',this.src);if(img.parent().hasClass('zoom')){img.parent().attr('href',this.src);}}}},initAlbumImages=function(changeCover,showMessage,callback){if(settings.images==null){$.getJSON('/ajax/images',{album:settings.id,sort:0,order:1,page:1,perPage:999999},function(data){settings.images=new Array();settings.images['items']=data.images;settings.images['count']=data.count;setupAlbumImages(changeCover,showMessage,callback);settings.images=null;});}else{setupAlbumImages(changeCover,showMessage,callback);}},setupAlbumImages=function(changeCover,showMessage,callback){var images=new Array();if(changeCover){images[settings.cover]=true;elements.albumImagesForm.coverHeader.show();elements.albumImagesForm.selectHeader.hide();}else{for(i=0;i<settings.images.count;++i){images[settings.images.items[i].deletehash]=true;}
elements.albumImagesForm.coverHeader.hide();elements.albumImagesForm.selectHeader.show();}
vars.albumImages=new ImgurAlbumImages({host:settings.host,album:settings.id,images:images,cdn_url:settings.cdn_url,totalCounter:$('<div/>'),totalCounterSuffix:$('<div/>'),imagesPerPage:64,changeCover:changeCover,mode:(settings.images.count>0?settings.id:1),onSubmitComplete:function(data){$.colorbox.close();if(showMessage){if(changeCover){humanMsg.displayMsg(messages.updateCover);}else{humanMsg.displayMsg(messages.updateImages);}}
if(changeCover){$(document).bind('cbox_closed',function(){$(document).unbind('cbox_closed');data=$.parseJSON(data);settings.cover=data[1][0];$('#album-'+settings.id).attr('data-cover',data[0][0]+'b.jpg').find('.cover img').attr('src',settings.cdn_url+'/'+data[0][0]+'s.jpg');imgurAlbum.changeSettings();});}else{if(typeof callback=='function'){callback(data);}else if(location.pathname!='/'>0){location.reload();}}}});vars.albumImages.init();},bindchangeImages=function(){vars.bindings.images=true;elements.albumImagesForm.form.submit(function(){vars.albumImages.submit();return false;});},editAccountBio=function(){var bio=$('#account-bio');var input=$('<textarea id="account-bio">'+jQuery.trim(bio.text())+'</textarea>');if(bio.text()==messages.defaultAccountBio){input.val('');}
input.blur(updateAccountBio);bio.replaceWith(input);input.autoResize({animate:false});input.focus();},updateAccountBio=function(){var bio=$('#account-bio'),div=$('<div id="account-bio" class="textbox profile access"></div>'),txt=jQuery.trim($(this).val());$.post('/ajax/accountbio',{bio:(txt==messages.defaultAccountBio?'':txt)},function(response){div.html(response?response:'<i>'+messages.defaultAccountBio+'</i>');});div.text(txt?txt:messages.defaultAccountBio);div.click(editAccountBio);bio.replaceWith(div);},bindDeleteAlbum=function(callback){vars.bindings.del=true;elements.deleteAlbumForm.no.click(function(){$.colorbox.close();});elements.deleteAlbumForm.yes.click(function(){elements.deleteAlbumForm.yes.disable();elements.deleteAlbumForm.loader.show();$.post(vars.ajaxURL+'delete/'+settings.id,'',function(data){elements.deleteAlbumForm.loader.hide();elements.deleteAlbumForm.yes.enable();$.colorbox.close();humanMsg.displayMsg(messages.deleteAlbum);if(typeof callback=='function'){callback(data);}else{if(location.pathname=='/'){$('#album-'+settings.id).fadeOut();}
if(location.pathname!='/'){setTimeout(function(){if(settings.signed){window.location=location.protocol+'//'+settings.auth.url+'.'+settings.host;}else{window.location='/';}},1000);}}}).error(function(){elements.deleteAlbumForm.yes.enable();elements.deleteAlbumForm.loader.hide();});});},bindCreateAlbum=function(callback){vars.bindings.create=true;elements.createAlbumForm.form.submit(function(){createAlbumSubmitHandler(callback);return false;});elements.createAlbumForm.privacyInput.change(function(){hideAlbumPrivacy();showAlbumPrivacy();});elements.createAlbumForm.privacyTitle.tipsy({html:false,opacity:1,gravity:'w'});},initCreateAlbum=function(){vars.creatingAlbum=true;$(elements.createAlbumForm.id).addClass('create');elements.createAlbumForm.header.text(messages.createAlbum);elements.createAlbumForm.titleInput.val('');elements.createAlbumForm.descriptionInput.val('');elements.createAlbumForm.layoutInput.removeAttr('checked').filter(':first').attr('checked','checked');elements.createAlbumForm.cover.removeAttr('src');if(settings.signed&&settings.auth){elements.createAlbumForm.privacyInput.removeAttr('checked').filter('[value='+settings.auth.album_privacy+']').attr('checked','checked');}else{elements.createAlbumForm.privacyInput.removeAttr('checked').filter(':first').attr('checked','checked');}
elements.createAlbumForm.titleInput.showPlaceholder();elements.createAlbumForm.descriptionInput.showPlaceholder();},initChangeSettings=function(){var album=$('#album-'+settings.id);vars.creatingAlbum=false;if(album.length){if(!settings.signed){$(elements.createAlbumForm.id).addClass('create');}else{$(elements.createAlbumForm.id).removeClass('create');}
elements.createAlbumForm.header.text(messages.albumSettings);elements.createAlbumForm.titleInput.val(album.attr('data-title'));elements.createAlbumForm.descriptionInput.val(album.attr('data-description'));elements.createAlbumForm.privacyInput.removeAttr('checked').filter('[value="'+album.attr('data-privacy')+'"]').attr('checked','checked');elements.createAlbumForm.layoutInput.removeAttr('checked').filter('[value="'+album.attr('data-layout')+'"]').attr('checked','checked');var cover=album.attr('data-cover');if(cover){elements.createAlbumForm.cover.attr('src',settings.cdn_url+'/'+album.attr('data-cover'));}
if(elements.createAlbumForm.titleInput.val()){elements.createAlbumForm.titleInput.removeClass('placeholder');}else{elements.createAlbumForm.titleInput.showPlaceholder();}
if(elements.createAlbumForm.descriptionInput.val()){elements.createAlbumForm.descriptionInput.removeClass('placeholder');}else{elements.createAlbumForm.descriptionInput.showPlaceholder();}}},showAlbumPrivacy=function(){elements.createAlbumForm.exlanationPublic.hide();elements.createAlbumForm.exlanationSecret.hide();elements.createAlbumForm.exlanationHidden.hide();elements.createAlbumForm.hiddenIcon.hide();elements.createAlbumForm.secretIcon.hide();switch(elements.createAlbumForm.privacyInput.filter(':checked').val()){case"0":elements.createAlbumForm.exlanationPublic.show();break;case"1":elements.createAlbumForm.hiddenIcon.show();elements.createAlbumForm.exlanationHidden.show();break;case"2":elements.createAlbumForm.secretIcon.show();elements.createAlbumForm.exlanationSecret.show();break;}
resizeCreateAlbumForm();},hideAlbumPrivacy=function(){elements.createAlbumForm.hiddenIcon.hide();elements.createAlbumForm.secretIcon.hide();elements.createAlbumForm.exlanationPublic.hide();elements.createAlbumForm.exlanationHidden.hide();elements.createAlbumForm.exlanationSecret.hide();},resizeCreateAlbumForm=function(){var form=$(elements.createAlbumForm.id);$.colorbox.resize({innerWidth:form.width()+20,innerHeight:form.height()+20});},createAlbumSubmitHandler=function(callback){if(!elements.createAlbumForm.errorbox.is(':hidden')){elements.createAlbumForm.errorbox.hide();resizeCreateAlbumForm();}
if(elements.createAlbumForm.titleInput.val().toLowerCase()=='album title (optional)'){elements.createAlbumForm.titleInput.val('');}
if(elements.createAlbumForm.descriptionInput.val().toLowerCase()=='album description (optional)'){elements.createAlbumForm.descriptionInput.val('');}
elements.createAlbumForm.submitButton.disable();elements.createAlbumForm.loader.show();var url=vars.creatingAlbum?'create':'settings/'+settings.id;$.post(vars.ajaxURL+url,elements.createAlbumForm.form.serialize(),function(data){data=$.parseJSON(data);elements.createAlbumForm.submitButton.enable();elements.createAlbumForm.loader.hide();if(!vars.creatingAlbum){if(data.id){$.colorbox.close();humanMsg.displayMsg(messages.updateSettings);var album=$('#album-'+data.id);album.attr('data-description',data.description).attr('data-layout',data.layout).attr('data-privacy',data.privacy).attr('data-title',data.title);if(typeof callback=='function'){callback(data);}else{location.reload();}}else{var errorstr='';for(key in errors){if(errorstr!='')errorstr+="\n";errorstr+=errors[key];}
elements.createAlbumForm.errorbox.text(errorstr).show();resizeCreateAlbumForm();}}else{$.colorbox.close();if(typeof callback=='function'){callback(data);}else{if(location.pathname=='/'){$(document).bind('cbox_closed',function(){$(document).unbind('cbox_closed');settings.id=data.id;settings.images=[];imgurAlbum.changeImages(false,false);$(document).bind('cbox_closed',function(){setTimeout(location.reload,1000);});});}else{window.location='/a/'+data.id;}}}}).error(function(){elements.createAlbumForm.submitButton.enable();elements.createAlbumForm.loader.hide();});return false;},openCreateAlbumColorbox=function(callback){$.colorbox.init();$.colorbox({href:elements.createAlbumForm.id,open:true,top:'15%',inline:true,transition:'none',preloading:false,scrolling:false,onComplete:function(){if(!vars.bindings.create){bindCreateAlbum(callback);}
showAlbumPrivacy();elements.createAlbumForm.titleInput.focus();},onCleanup:function(){$('.tipsy').remove();}});},positonScrollPanel=function(){var offset=90,padding=15;var position=function(){if($(window).scrollTop()>offset){elements.layout.blog.sidebar.css({top:padding,position:'fixed'});}else{elements.layout.blog.sidebar.css({position:'inherit'});}};$(window).scroll(position);$(window).resize(position);},loadImagesInView=function(force,wait){if(vars.loadingViewport&&!force)return;if(!force)vars.loadingViewport=true;elements.layout.global.container.find('.unloaded:in-viewport').each(function(){loadImage($(this));$(this).closest('.image').each(function(){$(this).find('.unloaded').each(function(){loadImage($(this));});});});if(!force){if(!wait)wait=150;setTimeout(function(){vars.loadingViewport=false},wait);}},carouselItemFirstIn=function(element,carousel,prev){if(element.index()==0){prev.addClass('disabled');}else{prev.removeClass('disabled');}},carouselItemLastIn=function(element,carousel,next){var length=carousel.jcarousel('items').length;if(element.index()==length-1){next.addClass('disabled');}else{next.removeClass('disabled');}},shrinkThumbsCarousel=function(){elements.layout.global.thumbsCarouselBottom.remove();elements.layout.global.thumbsCarouselContainer.addClass('shrunk');},getThumbsCarouselScroll=function(){if(settings.operation==operations.embed){var width=$('.embed').parent().width();var thumbSize=82;return Math.floor(width/thumbSize/2);}
if(settings.operation==operations.titledesc){return 3;}
switch(settings.layout){case layouts.blog:case layouts.vertical:return 6;case layouts.horizontal:return 5;}
return 0;},thumbsCarouselScroll=function(i,animate){try{if((!settings.operation&&settings.layout==layouts.horizontal)||settings.operation==operations.embed){var scroll=getThumbsCarouselScroll();if(i>=scroll&&i<settings.images.count-scroll){elements.layout.global.thumbsCarousel.jcarousel('scroll',i-scroll,animate);}else{if(i<scroll){elements.layout.global.thumbsCarousel.jcarousel('scroll',0,animate);}else{elements.layout.global.thumbsCarousel.jcarousel('scroll',settings.images.count-1,animate);}}}else if(settings.layout==layouts.vertical){var scroll=getThumbsCarouselScroll(),page=Math.floor(i/scroll);if((page*scroll)<=i){elements.layout.global.thumbsCarousel.jcarousel('scroll',(page*scroll/2),animate);}else{elements.layout.global.thumbsCarousel.jcarousel('scroll',((page*scroll/2)-1),animate);}}}catch(e){}},thumbsCarouselBind=function(){if(!settings.operation&&settings.layout==layouts.horizontal){if(settings.images.count<11){var offset=Math.round(84*(11-settings.images.count)/2);elements.layout.global.thumbsCarouselTop.css({borderLeft:offset.toString()+'px solid transparent',width:elements.layout.global.thumbsCarouselTop.width()-offset});}}
elements.layout.global.thumbsCarouselNext.click(function(){var scroll=getThumbsCarouselScroll();if(settings.operation!=operations.embed){if(settings.layout==layouts.vertical||settings.layout==layouts.blog){scroll=scroll/2;}}
elements.layout.global.thumbsCarousel.jcarousel('scroll','+='+scroll);return false;});elements.layout.global.thumbsCarouselPrev.click(function(){var scroll=getThumbsCarouselScroll();if(settings.operation!=operations.embed){if(settings.layout==layouts.vertical||settings.layout==layouts.blog){scroll=scroll/2;}}
elements.layout.global.thumbsCarousel.jcarousel('scroll','-='+scroll);return false;});elements.layout.global.thumbsCarousel.find('img').click(function(){var i=parseInt($(this).attr('data-index'));var image=settings.images.items[i];if((!settings.operation&&(settings.layout==layouts.vertical||settings.layout==layouts.horizontal))||settings.operation==operations.embed){scrollMainImage(i);}else if(settings.layout==layouts.blog||settings.operation==operations.titledesc){Imgur.setPageHash(image.hash);scrollImage('#'+image.hash,-10);}});$('.thumb-title-embed').tipsy({gravity:'s',opacity:0.95,html:true,live:true});var shrink=(settings.layout==layouts.blog||settings.layout==layouts.vertical)?getThumbsCarouselScroll()/2:getThumbsCarouselScroll();if(settings.images.count<=shrink&&(settings.layout!=layouts.horizontal&&settings.layout!=layouts.grid||settings.operation==operations.titledesc)){shrinkThumbsCarousel();}},thumbsCarouselItemVisibleIn=function(carousel){loadImage($(this).find('img'));},initThumbsCarousel=function(){elements.layout.global.thumbsCarousel.find('li').bind('jcarouselitemvisiblein',thumbsCarouselItemVisibleIn);elements.layout.global.thumbsCarouselTop.find('li').bind('jcarouselitemfirstin',function(carousel){carouselItemFirstIn($(this),elements.layout.global.thumbsCarouselTop,elements.layout.global.thumbsCarouselPrev);}).bind('jcarouselitemlastin',function(carousel){carouselItemLastIn($(this),elements.layout.global.thumbsCarouselTop,elements.layout.global.thumbsCarouselNext);});elements.layout.global.thumbsCarousel.jcarousel({animation:vars.thumbsSpeed});thumbsCarouselBind();},getImageSrc=function(i){if(i>=settings.images.count)i=settings.images.count-1;if(i<0)i=0;var image=settings.images.items[i],sizes=Imgur.getImageSizes(),hash=null,ext=null;var match=image.ext.match(/\?(.*)/);var hext='.jpg'+(match!=null?(match[0]):'');if(image.width>sizes.hugeThumb.width){hash=image.hash+'h';ext=hext;}else{hash=image.hash;ext=image.ext;}
return settings.cdn_url+'/'+hash+ext;},scrollMainImage=function(i){if(settings.images.count==0)return;if(i>=settings.images.count)i=settings.images.count-1;if(i<0)i=0;var src=getImageSrc(i),image=settings.images.items[i];vars.currentImageIndex=i;elements.layout.global.mainImage.removeAttr('src').attr('data-src',src).addClass('unloaded');if(elements.layout.global.mainImage.parent().hasClass('zoom')){elements.layout.global.mainImage.parent().replaceWith(elements.layout.global.mainImage);}
if(image.width>elements.layout.global.container.width()){elements.layout.global.mainImage.wrap('<a href="'+src+'" class="zoom" />');elements.layout.global.mainImage.parent().imageZoom();}
var zoomed=$('.jquery-image-zoom');if(zoomed.length){zoomed.click();}
mainCarouselItemVisible();Imgur.setPageHash(i);},mainCarouselSetup=function(){elements.layout.global.nextImage.click(function(){scrollMainImage(vars.currentImageIndex+1);return false;});elements.layout.global.prevImage.click(function(){scrollMainImage(vars.currentImageIndex-1);return false;});$(document).keydown(function(e){if(!e.ctrlKey&&!e.altKey&&!e.metaKey){if(e.keyCode==37){scrollMainImage(vars.currentImageIndex-1);}else if(e.keyCode==39){scrollMainImage(vars.currentImageIndex+1);}
return true;}
return true;});if(settings.operation==operations.embed&&$('#offsite').length<=0){elements.layout.global.container.parent().mousewheel(function(event,delta){if(delta>0){scrollMainImage(vars.currentImageIndex-1);}else{scrollMainImage(vars.currentImageIndex+1);}
event.preventDefault();event.stopPropagation();return false;});}
var index=getStartingIndex();scrollMainImage(index);},mainCarouselItemVisible=function(){var index=vars.currentImageIndex,img=elements.layout.global.mainImage,hash=settings.images.items[index];loadImage(img);if(hash.title){elements.layout.global.title.html(hash.title).show();}else{elements.layout.global.title.hide();}
if(hash.description){elements.layout.global.description.html(hash.description).show();}else{elements.layout.global.description.hide();}
if(settings.operation==operations.embed){setupEmbedScreen();if(hash.description){elements.layout.global.description.css('width',img.width());}}else if($(document).height()>vars.bodyHeight){vars.bodyHeight=$(document).height();$('body').css('height',vars.bodyHeight);}
thumbsCarouselScroll(index,false);elements.layout.global.thumbsCarousel.find('img').removeClass('selected');$('#thumb-'+hash.hash).addClass('selected');elements.layout.horizontal.imageCounter.text(index+1);$(elements.layout.global.imageHoverIconClass).filter('.view').html('<a href="'+settings.cdn_url+'/'+hash.hash+hash.ext+'" target="_blank"></a>');$(elements.layout.global.imageHoverIconClass).filter('.download').html('<a href="/download/'+hash.hash+(hash.title?'/'+hash.title:'')+'"></a>');if(index==settings.images.count-1){elements.layout.global.nextImage.addClass('disabled');}else{elements.layout.global.nextImage.removeClass('disabled');}
if(index==0){elements.layout.global.prevImage.addClass('disabled');}else{elements.layout.global.prevImage.removeClass('disabled');}
for(var p=index-1;p<index+settings.preloadCount&&p<=settings.images.count;++p){$.preloadImages(getImageSrc(p));}},initMainCarousel=function(){mainCarouselSetup();},scrollImage=function(imgElement,offset){if(vars.scrolling)return;vars.scrolling=true;$.smoothScroll({offset:offset,scrollTarget:imgElement,afterScroll:function(){loadImagesInView(true);vars.scrolling=false;}});},getCurrentBlogImage=function(){var inview=new Array();elements.layout.global.container.find('img').each(function(){if($.inviewport($(this),{threshold:0})){inview.push($(this));}});return inview[0]?inview[0].parents('.image'):null;}
initBlog=function(){loadImagesInView(true);$(window).scroll(function(){loadImagesInView();});positonScrollPanel();initThumbsCarousel();if(!settings.operation){$(document).keydown(function(e){var image=getCurrentBlogImage();if(image&&!vars.scrolling&&!vars.loadingViewport){if(!e.ctrlKey&&!e.altKey&&!e.metaKey){if(e.keyCode==37){scrollImage(image.prev().prev(),-5);}else if(e.keyCode==39){scrollImage(image.next().next(),-5);}}}
return true;});}
if(!settings.mobile){$('.zoom').imageZoom();}},initVertical=function(){$('.zoom').imageZoom();initThumbsCarousel();initMainCarousel();if(!settings.operation){var zoomed=$('.jquery-image-zoom');$(document).keyup(function(e){if(!e.ctrlKey&&!e.altKey&&!e.metaKey){if(e.keyCode==13){var zoomed=$('.jquery-image-zoom');if(zoomed.length){zoomed.click();}else{elements.layout.global.container.find('.zoom img').click();}}
return true;}
return true;});}},initHorizontal=function(){initThumbsCarousel();initMainCarousel();},bindGridThumbsClick=function(){$(elements.layout.grid.imageClass).unbind('click');$(elements.layout.grid.imageClass).click(function(e){var hash=$(this).attr('id');$.colorbox.init();$.colorbox({href:'#embed',inline:true,open:true,width:'90%',height:'90%',scrolling:false,transition:'none',onLoad:function(){$('.tipsy').remove();},onComplete:function(){setupEmbedCss();setupEmbedScreen();scrollMainImage(findImageIndex(hash));},onClosed:function(){elements.layout.global.mainImage.removeAttr('src');$('.tipsy').remove();}});e.preventDefault();e.stopPropagation();return false;});return false;},initGrid=function(){bindGridThumbsClick();$(document).bind('imagelist_load',function(){bindGridThumbsClick();});},initTitleDesc=function(){initBlog();elements.layout.titledesc.desc.keydown(function(e){if(e.keyCode==9&&!e.shiftKey){scrollImage($(this).parent().parent().next().next(),-13);}}).change(function(){$(this).parent().parent().removeClass('unchanged');});elements.layout.titledesc.title.keydown(function(e){if(e.keyCode==9&&e.shiftKey){scrollImage($(this).parent().parent().prev().prev(),-13);}}).change(function(){$(this).parent().parent().removeClass('unchanged');});elements.layout.titledesc.save.click(function(){elements.layout.titledesc.save.disable();elements.layout.titledesc.loader.show();elements.layout.titledesc.items.filter('.unchanged').each(function(){$(this).find('input').removeAttr('name');$(this).find('textarea').removeAttr('name');});$.post(vars.ajaxURL+'titledesc/'+settings.id,elements.layout.titledesc.form.serialize(),function(){humanMsg.displayMsg(messages.updateTitleDesc)
setTimeout(function(){window.location='/a/'+settings.id;},1000);}).error(function(){elements.layout.titledesc.save.enable();elements.layout.titledesc.loader.hide();});});elements.layout.titledesc.cancel.click(function(){window.location='/a/'+settings.id;});},rearrangeSortClick=function(){var id=$(this).attr('id');elements.layout.rearrange.loader.show();setTimeout(function(){var items=elements.layout.global.container.find(elements.layout.rearrange.sortableItem);elements.layout.rearrange.sorts.removeClass('current-selected');$('#'+id).addClass('current-selected');switch(id){case'none':elements.layout.rearrange.orderMenu.hide();items.sortElements(function(a,b){return parseInt($(a).attr('data-i'))>parseInt($(b).attr('data-i'))?1:-1;});break;case'filename':elements.layout.rearrange.orderMenu.show();items.sortElements(function(a,b){return $(a).attr('data-filename').toLowerCase()>$(b).attr('data-filename').toLowerCase()?vars.rearrangeOrder:-(vars.rearrangeOrder);});break;case'time':elements.layout.rearrange.orderMenu.show();items.sortElements(function(a,b){return $(a).attr('data-datetime')>$(b).attr('data-datetime')?vars.rearrangeOrder:-(vars.rearrangeOrder);});break;}
elements.layout.rearrange.loader.hide();loadImagesInView(true);},50);},rearrangeOrderClick=function(){var id=$(this).attr('id');elements.layout.rearrange.orders.removeClass('current-selected');$(this).addClass('current-selected');switch(id){case'asc':vars.rearrangeOrder=1;break;case'desc':vars.rearrangeOrder=-1;break;}
elements.layout.rearrange.sorts.filter('.current-selected').click();},initRearrange=function(){elements.layout.global.container.sortable({items:elements.layout.rearrange.sortableItem});$(elements.layout.rearrange.sortableItem).css('cursor','move');elements.layout.rearrange.saveLink.click(function(){elements.layout.rearrange.saveLink.disable();elements.layout.rearrange.loader.show();if(elements.layout.global.container.find(elements.layout.rearrange.sortableItem).length>0){var images=elements.layout.global.container.sortable('toArray');$.post(vars.ajaxURL+'rearrange/'+settings.id,'order='+images,function(){humanMsg.displayMsg(messages.rearrangeImages);setTimeout(function(){window.location='/a/'+settings.id;},1000);}).error(function(){elements.layout.rearrange.saveLink.enable();elements.layout.rearrange.loader.hide();});};});elements.layout.rearrange.sorts.click(rearrangeSortClick);elements.layout.rearrange.orders.click(rearrangeOrderClick);loadImagesInView(true);$(window).scroll(function(){loadImagesInView(false,100);});},setupEmbedCss=function(){$('head').append('<style>.main-carousel ul li { width: '+$('.embed').parent().width()+'px; }</style>');vars.bodyHeight=$('.embed').parent().height();},setupEmbedScreen=function(){var width=$('.embed').parent().width(),height=$('.embed').parent().height(),tHeight=elements.layout.global.thumbsCarousel.height()+18;if(!elements.layout.global.title.is(':hidden')){tHeight+=31;}
if(!elements.layout.global.description.is(':hidden')){tHeight+=23;}
elements.layout.global.container.css({lineHeight:(height-tHeight)+'px',height:vars.bodyHeight-tHeight});elements.layout.global.mainImage.css({maxHeight:height-tHeight,maxWidth:width});$('.embed #thumbs-top').css({width:Math.min(79*settings.images.count,width-65)});$('.embed .thumbs-carousel').css({width:Math.min(79*settings.images.count+45,width-20)});},initEmbed=function(){if(settings.layout==layouts.grid){initGrid();}
setupEmbedCss();setupEmbedScreen();initThumbsCarousel();initMainCarousel();$(window).resize(function(){setupEmbedCss();setupEmbedScreen();});$('.thumb-title-embed').tipsy({gravity:'s',opacity:0.95,html:true,live:true});},albumSortStop=function(){if(elements.subdomain.container.find(elements.subdomain.albumClass).length>0){var albums=elements.subdomain.container.sortable('toArray');var order=new Array();for(var i=0,count=albums.length;i<count;++i){order[i]=albums[i].substr(albums[i].indexOf('-')+1);}
$.post(vars.ajaxURL+'rearrange','order='+order);};},toggleEditButton=function(button){button.toggleClass('opened');button.siblings(elements.subdomain.editOptionsClass).toggle();},editButtonClickHandler=function(e){$('body').unbind('click');$('body').click(function(e){$('body').find('.opened').each(function(){toggleEditButton($(this));});});toggleEditButton($(this));e.stopPropagation();e.preventDefault();return false;},clipboardClick=function(e){flashElement($(e).siblings('input'));$(e).attr('title','copied');$(e).tipsy('show');$(e).attr('original-title','copy');},initEmbedClipboard=function(){vars.embedClipboard=new ZeroClipboard.Client();elements.embedAlbumForm.clipboardContainer.click(function(){clipboardClick(this);});elements.embedAlbumForm.clipboardContainer.tipsy({gravity:'e',opacity:1,html:true});};this.embedAlbum=function(){$.colorbox.init();$.colorbox({open:true,href:elements.embedAlbumForm.id,transition:'none',top:'15%',inline:true,onComplete:function(){elements.embedAlbumForm.embedCodeInput.val('<iframe class="imgur-album" width="100%" height="550" frameborder="0" src="http://'+settings.host+'/a/'+settings.id+'/embed"></iframe>');elements.embedAlbumForm.embedCodeInput.focus();elements.embedAlbumForm.embedCodeInput.selectAll();try{vars.embedClipboard.glue('embedcode-clipboard','embedcode-container');vars.embedClipboard.setText(elements.embedAlbumForm.embedCodeInput.val());}catch(e){}}});};this.createAlbum=function(callback){initCreateAlbum();openCreateAlbumColorbox(callback);};this.changeSettings=function(callback){initChangeSettings();openCreateAlbumColorbox(callback);};this.changeImages=function(changeCover,showMessage,callback){if(!changeCover){$.colorbox.init();}
$.colorbox({href:elements.albumImagesForm.id,open:true,inline:true,transition:'none',scrolling:false,onComplete:function(){if(!vars.bindings.images){bindchangeImages();}
initAlbumImages(changeCover,showMessage,callback);},onClosed:function(){vars.albumImages.destroy();vars.albumImages=null;}});};this.deleteAlbum=function(callback){$.colorbox.init();$.colorbox({href:elements.deleteAlbumForm.id,open:true,inline:true,top:'15%',transition:'none',scrolling:false,onComplete:function(){if(!vars.bindings.del){bindDeleteAlbum(callback);}}});};this.rearrangeAlbum=function(){window.location=location.protocol+'//'+settings.host+'/a/'+settings.id+'/rearrange';};this.changeTitleDesc=function(){window.location=location.protocol+'//'+settings.host+'/a/'+settings.id+'/titledesc';};this.generalInit=function(){elements.links.createAlbum.click(this.createAlbum);elements.links.changeSettings.click(this.changeSettings);elements.links.deleteAlbum.click(this.deleteAlbum);elements.links.changeImages.click(function(){imgurAlbum.changeImages(false,true)});elements.links.changeCover.click(function(){imgurAlbum.changeImages(true,true)});elements.links.embedAlbum.click(this.embedAlbum);elements.links.titleDesc.click(this.changeTitleDesc);elements.links.rearrange.click(this.rearrangeAlbum);Imgur.bindShareButtons();vars.bodyHeight=$('body').height();elements.embedAlbumForm.embedCodeInput.click(function(){$(this).selectAll()});initEmbedClipboard();};this.init=function(){switch(settings.operation){case operations.embed:initEmbed();break;case operations.rearrange:initRearrange();break;case operations.titledesc:initTitleDesc();break;default:switch(settings.layout){case layouts.blog:initBlog();break;case layouts.vertical:initVertical()
break;case layouts.horizontal:initHorizontal();break;case layouts.grid:initGrid();break;}}
this.generalInit();$('.thumb-title').tipsy({gravity:'n',opacity:0.95,offset:-10,html:true});};this.profileInit=function(){elements.subdomain.editButton.click(editButtonClickHandler);elements.subdomain.container.sortable({stop:albumSortStop,items:'.album'});elements.subdomain.accountBio.click(editAccountBio);elements.subdomain.editOptionsItems.click(function(){var id=$(this).parent().parent().parent().attr('id');settings.id=id.substr(id.indexOf('-')+1);});this.generalInit();};this.setAlbumID=function(id){settings.id=id;};$.extend(settings,Imgur.getSettings());$.extend(elements,Imgur.getElements());$.extend(settings,params);}
;(function(d){d.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(f,e){d.fx.step[e]=function(g){if(!g.colorInit){g.start=c(g.elem,e);g.end=b(g.end);g.colorInit=true}g.elem.style[e]="rgb("+[Math.max(Math.min(parseInt((g.pos*(g.end[0]-g.start[0]))+g.start[0]),255),0),Math.max(Math.min(parseInt((g.pos*(g.end[1]-g.start[1]))+g.start[1]),255),0),Math.max(Math.min(parseInt((g.pos*(g.end[2]-g.start[2]))+g.start[2]),255),0)].join(",")+")"}});function b(f){var e;if(f&&f.constructor==Array&&f.length==3){return f}if(e=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(f)){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}if(e=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(f)){return[parseFloat(e[1])*2.55,parseFloat(e[2])*2.55,parseFloat(e[3])*2.55]}if(e=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(f)){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}if(e=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(f)){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}if(e=/rgba\(0, 0, 0, 0\)/.exec(f)){return a.transparent}return a[d.trim(f).toLowerCase()]}function c(g,e){var f;do{f=d.curCSS(g,e);if(f!=""&&f!="transparent"||d.nodeName(g,"body")){break}e="backgroundColor"}while(g=g.parentNode);return b(f)}var a={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]}})(jQuery);function flashElement(e){$(e).animate({backgroundColor:'#85BF25'},100,function(){$(this).animate({backgroundColor:'#181817'},100);});};
;(function($){var combobox=function(element){var cb=this,selection=$('<div class="selection"></div>'),input=$('<input type="hidden" name="" value="" />'),triangle=$('<div class="triangle"></div>'),options=null,pos=null,settings={onChange:function(){return null},widthOffset:8},toggleOptions=function(){if(element.hasClass('opened')){element.removeClass('opened');options.css('z-index','0');}else{closeAll();element.addClass('opened');options.css('z-index','999');}
options.toggle();},closeAll=function(){$('.options').hide().css('z-index','0');$('.combobox').removeClass('opened');},stopEvents=function(e){if(!e){e=window.event;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;if(e.preventDefault){e.preventDefault();}
e.returnValue=false;return false;};this.run=function(){options=element.children('.options');options.hide().width(element.width()+settings.widthOffset);if(element.find('.selection').length==0){element.prepend(triangle).prepend(selection).append(input);}else{selection=element.find('.selection');input=element.find('input[type="hidden"]');}
selection.unbind('click');selection.click(function(e){toggleOptions();options.find('img.lazyload').each(function(){$(this).attr('src',$(this).attr('data-src'));$(this).removeClass('lazyload');});stopEvents(e);});$('body').click(function(e){if(element.hasClass('opened')){toggleOptions();}});options.find('.item').unbind('click');options.find('.item').click(function(){$('div[name="'+element.attr('name')+'"]').find('.selection').html($(this).text().replace(/</g,'&lt;').replace(/>/g,'&gt;'));input.attr('value',$(this).attr('value'));options.find('.item').removeClass('selected');$(this).addClass('selected');toggleOptions();settings.onChange(element.attr('name'),input.attr('value'));});selection.html(element.find('.selected').text().replace(/</g,'&lt;').replace(/>/g,'&gt;'));input.attr('name',element.attr('name')).attr('value',element.find('.selected').attr('value'));};this.init=function(options){if(options){$.extend(settings,options);}
this.run();};};methods={init:function(options){return this.each(function(){(new combobox($(this))).init(options);});}};$.fn.combobox=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{return $.error('Method '+method+' does not exist');}};}(jQuery));
;ImgurShare=function(params){var imgurShare=this,settings={hashes:new Array()},linkTypes={nondirect:0,direct:1,html:2,bbcode:3,linkedbbcode:4,markdown:5},links=Imgur.getLinkCodes(),elements={image:$('#image'),title:$('#title'),description:$('#description'),linkInputs:$('#content input[type="text"]'),clipboardContainer:$('.clipboard-container'),generateLinksLink:$('#generate-links-link'),comboboxes:$('.combobox'),generateLinksID:'#generate-links',linkTextarea:$('#generate-links textarea'),generateClipboard:$('#generate-clipboard'),navigation:{images:$('#more-images a'),next:$('#next-prev .next'),prev:$('#next-prev .prev')},links:{editImage:$('#edit-image'),createAlbum:$('#create-album a'),deletion:$('#deletion'),imageSizes:$('#sizes a'),deletionEmail:$('#deletion-email-link'),titleDescription:$('#title-description-link')},deletionForm:{id:'#deletion-email',form:$('#deletion-email form'),emailAddressInput:$('#deletion-email-textbox'),sentConfirmationDiv:$('#deletion-email-sent')}},imageSizes=Imgur.getImageSizes(),linkCodes=Imgur.getLinkCodes(),vars={clipboards:new Array(),generateClipboard:null,currentImageIndex:0,imageSize:imageSizes.original,imageSuffix:imageSizes.original.suffix,linkType:linkTypes.nondirect},showNext=function(){if(vars.currentImageIndex+1>settings.hashes.length-1){vars.currentImageIndex=-1;}
changeImage(vars.currentImageIndex+1,true);},showPrev=function(){if(vars.currentImageIndex-1<0){vars.currentImageIndex=settings.hashes.length;}
changeImage(vars.currentImageIndex-1,true);},changeImage=function(i,flashTags){var hash=settings.hashes[i];if(vars.currentImageIndex==i){var changeDeletionLink=false;}else{var changeDeletionLink=true;vars.currentImageIndex=i;}
elements.navigation.images.removeClass('green');$('#'+hash.hash).addClass('green');var link=settings.cdn_url+'/'+hash.hash+vars.imageSize.suffix+hash.ext;elements.image.html('<a href="'+link+'"><img src="'+link+'" /></a>');changeTitle(hash.title);changeDescription(hash.description);updateLinks(i,changeDeletionLink,flashTags);elements.links.editImage.attr('href','/edit?deletehash='+hash.deletehash);Imgur.setHash(hash);Imgur.setURL(hash.hash);Imgur.bindShareButtons();if(settings.hashes.length>1){Imgur.setPageHash(vars.currentImageIndex);}},changeTitle=function(title){if(!elements.title.length){elements.title=$('<h2 id="title"></h2>');elements.image.parent().prepend(elements.title);}
if(title!=null&&title!=''){elements.titleDescriptionForm.titleInput.val(title).removeClass('placeholder');elements.title.text(title).show();document.title=title+' - Imgur';}else{elements.titleDescriptionForm.titleInput.val('');elements.title.hide();document.title='imgur: the simple image sharer';}},changeDescription=function(desc){if(!elements.description.length){elements.description=$('<div id="description" class="textbox"><pre/></div>');elements.image.parent().append(elements.description);}
if(desc!=null&&desc!=''){elements.titleDescriptionForm.descriptionInput.val(desc).removeClass('placeholder');elements.description.text(desc).show();}else{elements.titleDescriptionForm.descriptionInput.val('');elements.description.hide();}},bindImageNavLinks=function(){elements.navigation.images.each(function(i){$(this).click(function(){changeImage(i,true)});});},bindArrowKeys=function(){$(document).keydown(function(e){if(!e.ctrlKey&&!e.altKey&&!e.metaKey){if(!$('#cboxOverlay').is(':hidden'))return true;if(e.keyCode==37){showPrev();}else if(e.keyCode==39){showNext();}
return true;}
return true;});},deletionEmailSubmitHandler=function(){var deletehashes=new Array()
var email=elements.deletionForm.emailAddressInput.val();if(email.search('@')>0){elements.deletionForm.emailAddressInput.val('');elements.deletionForm.emailAddressInput.blur();elements.deletionForm.sentConfirmationDiv.fadeIn();for(var i=0,count=settings.hashes.length;i<count;++i){deletehashes[i]=settings.hashes[i].deletehash;}
$.post('/share/emaildeletionlinks/'+deletehashes.join('|'),{email:email});setTimeout(function(){$.colorbox.close();elements.deletionForm.sentConfirmationDiv.fadeOut();},1000);}
return false;},changeSize=function(e){vars.imageSize=imageSizes[$(e).attr('id')];elements.links.imageSizes.removeClass('green');$(e).addClass('green');changeImage(vars.currentImageIndex,true);},updateLinks=function(i,changeDeletionLink,flashTags){var link=null;$(elements.linkInputs).each(function(){link=linkCodes[$(this).attr('id')];if(link!=linkCodes['deletion']||changeDeletionLink){$(this).val(link.replace(/{host}/g,settings.host).replace(/{cdn_url}/g,settings.cdn_url).replace(/{hash}/g,settings.hashes[i].hash).replace(/{size}/g,vars.imageSize.suffix).replace(/{ext}/g,settings.hashes[i].ext).replace(/{deletehash}/g,settings.hashes[i].deletehash));if(flashTags){flashElement($(this));}}});},setupComboboxes=function(){elements.comboboxes.combobox({onChange:function(element,value){switch(element){case'link-types':vars.linkType=parseInt(value);generateLinks();break;case'image-sizes':vars.imageSuffix=value;generateLinks();break;}}});},getLink=function(hash,ext){var type=null;switch(vars.linkType){case linkTypes.nondirect:type=links.nondirect;break;case linkTypes.direct:type=links.direct;break;case linkTypes.html:type=links.html;break;case linkTypes.bbcode:type=links.bbcode;break;case linkTypes.linkedbbcode:type=links.linkedbbcode;break;case linkTypes.markdown:type=links.markdown;break;}
return type.replace(/{host}/g,settings.host).replace(/{cdn_url}/g,settings.cdn_url).replace(/{hash}/g,hash).replace(/{size}/g,vars.imageSuffix).replace(/{ext}/g,ext);},generateLinks=function(){var separator="\n";var link='';for(var hash in settings.hashes){link+=getLink(settings.hashes[hash].hash,settings.hashes[hash].ext)+separator;}
var re=new RegExp(separator+'$','g');elements.linkTextarea.html(link.replace(re,''));elements.linkTextarea.selectAll();},openGenerateLinks=function(){$.colorbox({transition:'none',href:elements.generateLinksID,inline:true,open:true,onLoad:function(){generateLinks();},onComplete:function(){elements.linkTextarea.selectAll();elements.generateClipboard.find('embed').parent().remove();vars.generateClipboard=new ZeroClipboard.Client();vars.generateClipboard.glue(elements.generateClipboard.attr('id'),elements.generateClipboard.parent().attr('id'));vars.generateClipboard.addEventListener('mouseOver',function(){vars.generateClipboard.setText(elements.linkTextarea.val());});vars.generateClipboard.addEventListener('onMouseUp',function(){flashElement(elements.linkTextarea);});}});},initClipboards=function(){$(elements.linkInputs).each(function(i){var id=$(elements.linkInputs[i]).attr('id');vars.clipboards[id]=new ZeroClipboard.Client();vars.clipboards[id].glue(id+'-clipboard',id+'-container');vars.clipboards[id].addEventListener('onMouseUp',function(){clipboardClick($(elements.linkInputs[i]).siblings('.clipboard-container'));});vars.clipboards[id].addEventListener('mouseOver',function(id){return function(event){clipboardHover(id);}}(id),false);});},clipboardHover=function(id){vars.clipboards[id].setText($('#'+id).val());},clipboardClick=function(e){$(e).attr('title','copied');$(e).tipsy('show');$(e).attr('original-title','copy');flashElement($(e).siblings('input'));};this.init=function(){var Album=new ImgurAlbum();if(settings.hashes.length>1){pageHash=parseInt(Imgur.getPageHash());if(pageHash&&pageHash<settings.hashes.length){changeImage(pageHash,false);}
bindArrowKeys();bindImageNavLinks();elements.navigation.next.click(showNext);elements.navigation.prev.click(showPrev);}
Imgur.setHash(settings.hashes[vars.currentImageIndex]);Imgur.setURL(settings.hashes[vars.currentImageIndex].hash);elements.linkInputs.mousedown(function(){$(this).selectAll()});elements.linkInputs.click(function(){$(this).selectAll()});initClipboards();elements.clipboardContainer.click(function(){clipboardClick(this);});elements.clipboardContainer.tipsy({gravity:'e',opacity:1,html:true});elements.links.imageSizes.each(function(i){$(this).click(function(){if(typeof imageSizes[$(this).attr('id')]!=='undefined'){changeSize($(this));}});});elements.links.deletionEmail.colorbox({href:elements.deletionForm.id,inline:true,transition:'none',onComplete:function(){elements.deletionForm.emailAddressInput.showPlaceholder();elements.deletionForm.emailAddressInput.focus();}});setupComboboxes();elements.links.createAlbum.click(Album.createAlbum);elements.links.titleDescription.click(Imgur.addTitleDescription);elements.deletionForm.form.submit(deletionEmailSubmitHandler);elements.generateLinksLink.click(openGenerateLinks);elements.linkTextarea.mousedown(function(){$(this).selectAll();});elements.linkTextarea.click(function(){$(this).selectAll();});Imgur.bindTitleDescriptionSubmit(function(data){location.reload(false);});Imgur.bindShareButtons();};$.extend(settings,Imgur.getSettings());$.extend(elements,Imgur.getElements());$.extend(settings,params);changeTitle(settings.hashes[0].title);changeDescription(settings.hashes[0].description);};